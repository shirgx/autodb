# Проект "Автосервис"

## Обзор проекта

Система управления базой данных автосервиса с функциями анализа производительности запросов SQL. Проект демонстрирует работу с PostgreSQL в Python, реализует операции CRUD (создание, чтение, обновление, удаление данных), генерацию тестовых данных и измерение производительности различных SQL-операций.

## Функциональность

1. **Управление данными автосервиса**
   - Хранение информации о клиентах и их автомобилях
   - Учет мастеров и их специализаций
   - Ведение заказов на обслуживание автомобилей
   - Учет услуг, запчастей и их использования в заказах

2. **Тесты производительности**
   - Измерение скорости генерации тестовых данных
   - Измерение скорости операций вставки в БД
   - Анализ производительности JOIN-запросов
   - Оценка эффективности индексов для оптимизации запросов

## Структура проекта

- **config.py**: Конфигурация подключения к базе данных

- **lib/**: Основные библиотечные модули
  - **db.py**: Базовый модуль для работы с БД, реализует контекстный менеджер
  - **schema.py**: Определение структуры таблиц и их создание
  - **data_gen.py**: Генератор тестовых данных для всех сущностей
  - **backup.py**: Сохранение и восстановление данных
  - **sandbox.py**: Создание тестовой среды

- **tests/**: Тестовые модули
  - **test_basic.py**: Базовый тест инициализации БД

- **investigations/**: Модули для анализа производительности
  - **performance.py**: Тесты базовой производительности операций
  - **index_effectiveness.py**: Оценка влияния индексов на скорость запросов
  - **join_performance.py**: Анализ производительности JOIN-запросов
  - **plot_utils.py**: Утилиты для построения графиков результатов
  - **simple_dbms.py**: Простая самописная СУБД для демонстрации принципов работы

## Архитектура базы данных

Схема состоит из следующих таблиц:

1. **clients**: Клиенты автосервиса (ID, имя)
2. **masters**: Мастера сервиса (ID, имя, специализация)
3. **master_profiles**: Расширенные профили мастеров (биография, опыт)
4. **cars**: Автомобили клиентов (ID, модель, год, ID владельца)
5. **services**: Услуги сервиса (ID, название, цена)
6. **parts**: Запчасти (ID, название, цена)
7. **orders**: Заказы (ID, ID автомобиля, ID мастера, дата, общая стоимость)
8. **order_services**: Связь заказов с услугами (ID заказа, ID услуги, количество)
9. **order_parts**: Связь заказов с запчастями (ID заказа, ID запчасти, количество)

## Требования к системе

- Python 3.8 или выше
- PostgreSQL 12 или выше
- Библиотеки Python:
  - psycopg2-binary: для работы с PostgreSQL
  - matplotlib: для построения графиков

## Установка и запуск

2. **Установка зависимостей**:
   ```
   pip install psycopg2-binary matplotlib
   ```

3. **Настройка базы данных**:
   - Убедитесь, что PostgreSQL установлен и запущен
   - Настройте подключение в файле `config.py`
   - Создайте базу данных:
     ```
     createdb -U postgres autodb
     ```

4. **Инициализация проекта**:
   ```
   chmod +x setup.sh
   ./setup.sh
   ```
   или
   ```
   python -m project_autoservice
   ```

5. **Запуск тестов производительности**:
   ```
   python -m investigations.performance
   python -m investigations.index_effectiveness
   python -m investigations.join_performance
   ```

## Как работает код

### Модуль `lib/db.py`
Реализует контекстный менеджер для работы с базой данных, автоматически обрабатывает соединения, транзакции и ошибки.

### Модуль `lib/schema.py`
Создает структуру таблиц базы данных, определяет связи между ними и ограничения целостности.

### Модуль `lib/data_gen.py`
Генерирует случайные данные для всех сущностей БД: клиентов, автомобилей, мастеров, заказов и связанных таблиц.

### Модуль `lib/backup.py`
Предоставляет функции для сохранения данных в базе, их экспорта в CSV и восстановления из резервных копий.

### Модуль `tests/test_basic.py`
Проверяет подключение к БД, создает схему таблиц, заполняет их тестовыми данными и выполняет проверочные запросы.

### Модуль `investigations/performance.py`
Измеряет и анализирует скорость генерации данных, операций вставки в базу данных и сложных JOIN-запросов.

### Модуль `investigations/index_effectiveness.py`
Сравнивает скорость выполнения запросов с использованием индексов и без них, демонстрируя их влияние.

### Модуль `investigations/join_performance.py`
Анализирует производительность простых и сложных JOIN-запросов между таблицами.

### Модуль `investigations/plot_utils.py`
Предоставляет функции для визуализации результатов тестов в виде графиков с помощью библиотеки matplotlib.

## Результаты тестов производительности

После запуска тестов в текущей директории появятся графики:
- `generation_performance.png`: Скорость генерации данных
- `insertion_performance.png`: Скорость вставки данных в БД
- `select_index_vs_noindex.png`: Сравнение SELECT с индексом и без
- `join_performance_comparison.png`: Сравнение скорости разных JOIN-запросов

Эти графики показывают, как объем данных влияет на производительность системы и насколько эффективными оказываются различные методы оптимизации запросов.
